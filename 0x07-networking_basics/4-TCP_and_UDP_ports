#!/usr/bin/env bash
# This script displays listening TCP and UDP ports along with the PID and name of the program to which each socket belongs.

# Display listening TCP ports
echo "Active Internet connections (only servers)"
echo "Proto Recv-Q Send-Q Local Address           Foreign Address         State       PID/Program name"
netstat -tuln | awk '/^tcp/ {print $1,$4,$5,$6}' | while read -r proto local foreign state; do
    pid=$(lsof -i "${proto,,}:${local##*:}" | awk '/LISTEN/ {print $2}')
    program=$(ps -p "$pid" -o comm=)
    echo "$proto       $local      $foreign      $state       $pid/$program"
done

# Display listening UDP ports
netstat -uln | awk '/^udp/ {print $1,$4,"*:*",$6}' | while read -r proto local foreign state; do
    pid=$(lsof -i "${proto,,}:${local##*:}" | awk '/LISTEN/ {print $2}')
    program=$(ps -p "$pid" -o comm=)
    echo "$proto       $local      $foreign               $pid/$program"
done

